import{r as i,j as n,L as G}from"./index-Du0vXYoH.js";import{F as I}from"./Footer-DlYLaU0K.js";import{u as h,E as w}from"./App-CBnKlSPQ.js";import{T as M,g as P,a as L,P as $,b as V,c as E}from"./PokemonCardSkeleton-HXPW-wch.js";import{u as A}from"./useFavorites-Vdnob2mK.js";const T=e=>{const t=h(),r=i.useCallback(a=>{const s=Date.now(),c=(e==="type"?t.selectedType:t.selectedGeneration)===a?null:a;h.setState({loading:!0,pokemons:[],error:null,lastRequestId:s}),setTimeout(()=>{h.getState().lastRequestId===s&&(e==="type"?t.setSelectedType(c):t.setSelectedGeneration(c))},50)},[e,t]),o=i.useCallback(()=>{const a=Date.now();h.setState({loading:!0,pokemons:[],error:null,lastRequestId:a}),setTimeout(()=>{h.getState().lastRequestId===a&&(e==="type"?t.setSelectedType(null):t.setSelectedGeneration(null))},50)},[e,t]);return{handleFilterClick:r,handleFilterReset:o}},B=i.memo(()=>{const{pokemonTypes:e,selectedType:t,fetchPokemonTypes:r}=h(),{handleFilterClick:o,handleFilterReset:a}=T("type");return i.useEffect(()=>{r()},[r]),n.jsxs("div",{className:"types-filter",children:[n.jsxs("div",{className:"types-filter-header",children:[n.jsx("h3",{children:"Фильтр по типам"}),t&&n.jsx("button",{className:"back-button",onClick:a,children:"Сбросить тип"})]}),n.jsx("div",{className:"types-badges",children:e.map(s=>n.jsx(M,{type:s.name,onClick:o,isActive:t===s.name},s.name))})]})}),q=({generation:e,onClick:t,isActive:r=!1})=>{const o=L(e),a=P(e),s=["generation-badge",r&&"active",t&&"clickable"].filter(Boolean).join(" "),l=t?()=>t(e):void 0;return n.jsx("div",{className:s,onClick:l,"aria-label":`Поколение ${o}`,style:{backgroundColor:a,color:"rgba(0,0,0,0.65)"},children:n.jsx("span",{className:"generation-badge-name",children:o})})},D=i.memo(q),O=i.memo(()=>{const{generations:e,selectedGeneration:t,fetchGenerations:r}=h(),{handleFilterClick:o,handleFilterReset:a}=T("generation");return i.useEffect(()=>{r()},[r,e.length]),n.jsxs("div",{className:"generations-filter",children:[n.jsxs("div",{className:"generations-filter-header",children:[n.jsx("h3",{children:"Фильтр по поколениям"}),t&&n.jsx("button",{className:"back-button",onClick:a,children:"Сбросить поколение"})]}),n.jsx("div",{className:"generations-badges",children:e.map(s=>n.jsx(D,{generation:s.name,onClick:o,isActive:t===s.name},s.name))})]})}),_=i.memo(({selectedType:e,selectedGeneration:t,onResetFilters:r})=>n.jsxs("div",{className:"filters-container",children:[n.jsx(B,{}),n.jsx(O,{}),(e||t)&&n.jsx("button",{className:"reset-all-filters back-button",onClick:r,children:"Сбросить все фильтры"})]}));var R=new Map,y=new WeakMap,F=0,H=void 0;function Q(e){return e?(y.has(e)||(F+=1,y.set(e,F.toString())),y.get(e)):"0"}function U(e){return Object.keys(e).sort().filter(t=>e[t]!==void 0).map(t=>`${t}_${t==="root"?Q(e.root):e[t]}`).toString()}function z(e){const t=U(e);let r=R.get(t);if(!r){const o=new Map;let a;const s=new IntersectionObserver(l=>{l.forEach(c=>{var d;const g=c.isIntersecting&&a.some(u=>c.intersectionRatio>=u);e.trackVisibility&&typeof c.isVisible>"u"&&(c.isVisible=g),(d=o.get(c.target))==null||d.forEach(u=>{u(g,c)})})},e);a=s.thresholds||(Array.isArray(e.threshold)?e.threshold:[e.threshold||0]),r={id:t,observer:s,elements:o},R.set(t,r)}return r}function W(e,t,r={},o=H){if(typeof window.IntersectionObserver>"u"&&o!==void 0){const d=e.getBoundingClientRect();return t(o,{isIntersecting:o,target:e,intersectionRatio:typeof r.threshold=="number"?r.threshold:0,time:0,boundingClientRect:d,intersectionRect:d,rootBounds:d}),()=>{}}const{id:a,observer:s,elements:l}=z(r),c=l.get(e)||[];return l.has(e)||l.set(e,c),c.push(t),s.observe(e),function(){c.splice(c.indexOf(t),1),c.length===0&&(l.delete(e),s.unobserve(e)),l.size===0&&(s.disconnect(),R.delete(a))}}function J({threshold:e,delay:t,trackVisibility:r,rootMargin:o,root:a,triggerOnce:s,skip:l,initialInView:c,fallbackInView:d,onChange:g}={}){var u;const[v,k]=i.useState(null),x=i.useRef(g),[f,m]=i.useState({inView:!!c,entry:void 0});x.current=g,i.useEffect(()=>{if(l||!v)return;let j;return j=W(v,(C,N)=>{m({inView:C,entry:N}),x.current&&x.current(C,N),N.isIntersecting&&s&&j&&(j(),j=void 0)},{root:a,rootMargin:o,threshold:e,trackVisibility:r,delay:t},d),()=>{j&&j()}},[Array.isArray(e)?e.toString():e,v,a,o,s,l,r,d,t]);const b=(u=f.entry)==null?void 0:u.target,S=i.useRef(void 0);!v&&b&&!s&&!l&&S.current!==b&&(S.current=b,m({inView:!!c,entry:void 0}));const p=[k,f.inView,f.entry];return p.ref=p[0],p.inView=p[1],p.entry=p[2],p}function K(e){const t=i.useRef();return i.useEffect(()=>{t.current=e},[e]),t.current}const X=()=>{const{pokemons:e,loading:t,error:r,hasMore:o,fetchPokemons:a,searchQuery:s,selectedType:l,selectedGeneration:c}=h(),{favorites:d}=A();i.useEffect(()=>{const m=()=>{setTimeout(()=>{},10)};return window.addEventListener("favorites-updated",m),()=>{window.removeEventListener("favorites-updated",m)}},[]);const{ref:g,inView:u}=J({threshold:.1,triggerOnce:!1}),v=i.useMemo(()=>e.length===0&&!s&&!l&&!c&&!t,[e.length,s,l,c,t]);i.useMemo(()=>!s&&e.length===0&&!t,[s,e.length,t]);const k=i.useMemo(()=>u&&o&&!t&&!s&&!l&&!c,[u,o,t,s,l,c]),x=K(s),f=i.useCallback(()=>{a()},[a]);return i.useEffect(()=>{v&&f()},[v,f]),i.useEffect(()=>{x&&!s&&e.length===0&&!t&&f()},[s,e.length,t,x,f]),i.useEffect(()=>{k&&f()},[k,f]),r&&e.length===0?n.jsx(w,{error:typeof r=="string"?new Error(r):r}):!t&&e.length===0&&(l||c)?n.jsx(w,{message:"Покемоны не найдены. Попробуйте изменить фильтры."}):n.jsxs("div",{className:"pokemon-list-container",children:[n.jsxs("div",{className:"pokemon-grid",children:[e.map(m=>n.jsx($,{pokemon:m,className:"pokemon-list-card"},m.id)),t&&Array(4).fill(0).map((m,b)=>n.jsx(V,{},`skeleton-${b}`))]}),e.length===0&&!t&&s&&n.jsxs("div",{className:"empty-search-result",children:[n.jsx("h3",{children:"Покемоны не найдены"}),n.jsx("p",{children:"Попробуйте изменить поисковый запрос"})]}),o&&!s&&!l&&!c&&n.jsx("div",{ref:g,className:"scroll-trigger"})]})},Y=({loading:e,offset:t,pokemons:r})=>{const o=i.useMemo(()=>e&&t===0&&r.length===0,[e,t,r.length]);return n.jsxs(n.Fragment,{children:[e&&n.jsx("div",{className:"filter-updating",children:"Обновление данных..."}),o?n.jsx(G,{}):n.jsx(X,{})]})},re=()=>{const{loading:e,offset:t,pokemons:r,searchQuery:o,selectedType:a,selectedGeneration:s,resetSearch:l}=h(),c=i.useCallback(()=>{l()},[l]),d=i.useMemo(()=>o?"Результаты поиска":a&&s?`Покемоны типа ${E(a)} из поколения ${s.replace("generation-","").toUpperCase()}`:a?`Покемоны типа ${E(a)}`:s?`Покемоны поколения ${s.replace("generation-","").toUpperCase()}`:"Все покемоны",[o,a,s]);return i.useEffect(()=>{window.scrollTo(0,0)},[]),i.useEffect(()=>{r.length===0&&!a&&!s&&!o&&!e&&(async()=>await h.getState().fetchPokemons())()},[r.length,a,s,o,e]),n.jsxs("div",{className:"home-page",children:[n.jsx("main",{className:"main-content",children:n.jsxs("div",{className:"container",children:[n.jsx(_,{selectedType:a,selectedGeneration:s,onResetFilters:c}),n.jsx("h2",{className:"section-title",children:d}),n.jsx(Y,{loading:e,offset:t,pokemons:r})]})}),n.jsx(I,{})]})};export{re as default};
